---
// 1. Node Detection Logic
const url = Astro.url;
const params = url.searchParams;
const sourceTag = params.get('utm_source') || "";
const domain = url.hostname.toLowerCase();

// Hybrid Detection
const isIKNode = domain.includes('indigenousknowledge') || sourceTag.includes('indigenousknowledge') || sourceTag.includes('kanna');
const isScienceNode = domain.includes('southafricanbotanical') || sourceTag.includes('science');

// 2. Identity Switcher
let identity = {
  title: "SABM",
  suffix: "Compliance Gateway",
  subtitle: "Sovereign Infrastructure for South African Botanical Trade",
  color: "#4ade80", 
  accent: "rgba(34, 197, 94, 0.1)",
  label: "TRADE & EXPORT NODE",
  description: "This gateway facilitates BABS & NEMBA compliance for the South African botanical supply chain."
};

if (isIKNode) {
  identity = {
    title: "IK",
    suffix: "Protection Shield",
    subtitle: "Sovereign Repository for Benefit Sharing & Heritage",
    color: "#f87171", 
    accent: "rgba(248, 113, 113, 0.1)",
    label: "HERITAGE & IK PROTECTION NODE",
    description: "The primary notary for Indigenous Knowledge (IK) protection and royalty management."
  };
} else if (isScienceNode) {
  identity = {
    title: "SABM",
    suffix: "Science & Innovation",
    subtitle: "Institutional Repository for Phytochemical Integrity",
    color: "#38bdf8", 
    accent: "rgba(56, 189, 248, 0.1)",
    label: "SCIENCE & PHYTOTECH NODE",
    description: "The scientific archive for South African botanical assets and DNA barcoding."
  };
}
---

<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width" />
		<title>{identity.title} {identity.suffix}</title>
	</head>
	<body style="margin: 0; font-family: sans-serif; background: #0f172a; color: white;">
		
    <div style={`background: ${identity.color}; color: #000; padding: 10px; text-align: center; font-weight: bold;`}>
      INSTITUTIONAL LAYER: {identity.label}
    </div>

    <main style="max-width: 800px; margin: auto; padding: 40px; text-align: center;">
			<header style="margin-bottom: 50px;">
				<h1 style={`font-size: 3rem; color: ${identity.color};`}>
					{identity.title} {identity.suffix}
				</h1>
				<p style="color: #94a3b8;">{identity.subtitle}</p>
			</header>

			<section style="background: #1e293b; padding: 30px; border-radius: 10px; border: 1px solid #334155;">
				<p>{identity.description}</p>
			</section>

			<footer style="margin-top: 50px; color: #64748b; font-size: 0.8rem;">
				<p>Â© 2026 South African Botanical Management.</p>
        <p>Active Domain: {domain}</p>
			</footer>
		</main>
	</body>
</html>

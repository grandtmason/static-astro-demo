---
// 1. Node Detection & Hybrid Identity Logic
const url = Astro.url;
const params = url.searchParams;

// This checks BOTH the real domain AND the URL tag (for when hosting redirects)
const sourceTag = params.get('utm_source')?.toLowerCase() || "";
const domain = url.hostname.toLowerCase();

// Hybrid Check: Does the domain OR the tag mention the specific node?
const isIKNode = domain.includes('indigenousknowledge') || sourceTag.includes('indigenousknowledge') || sourceTag.includes('kanna');
const isScienceNode = domain.includes('southafricanbotanical') || sourceTag.includes('science') || sourceTag.includes('research');

// 2. Unified Institutional Schema (The Valuation Core)
const schemaData = {
  "@context": "https://schema.org",
  "@type": "GovernmentService",
  "name": "SABM Compliance Gateway",
  "alternateName": "South African Botanical Management",
  "url": "https://southafricanbotanical.org.za",
  "sameAs": [
    "https://botanicalcompliance.africa",
    "https://indigenousknowledge.science",
    "https://mesembrine.science",
    "https://africanginger.health",
    "https://aloeferox.science",
    "https://kannawholesale.co.za",
    "https://rooibostrust.org",
    "https://honeybushresearch.health",
    "https://siphonochilus.institute",
    "https://warburgia.science"
  ]
};

// 3. Identity Switcher (Dynamic Branding)
let identity = {
  title: "SABM",
  suffix: "Compliance Gateway",
  subtitle: "Sovereign Infrastructure for South African Botanical Trade",
  color: "#4ade80", // Trade Green
  accent: "rgba(34, 197, 94, 0.1)",
  label: "TRADE & EXPORT NODE",
  description: "This gateway facilitates BABS & NEMBA compliance for the South African botanical supply chain. We provide the digital 'Toll-Booth' infrastructure for frictionless trade."
};

if (isIKNode) {
  identity = {
    title: "IK",
    suffix: "Protection Shield",
    subtitle: "Sovereign Repository for Benefit Sharing & Heritage",
    color: "#f87171", // Heritage Red
    accent: "rgba(248, 113, 113, 0.1)",
    label: "HERITAGE & IK PROTECTION NODE",
    description: "The primary notary for Indigenous Knowledge (IK) protection. This node secures the 1% automated royalty splitter for traditional holders."
  };
} else if (isScienceNode) {
  identity = {
    title: "SABM",
    suffix: "Science & Innovation",
    subtitle: "Institutional Repository for Phytochemical Integrity",
    color: "#38bdf8", // Science Blue
    accent: "rgba(56, 189, 248, 0.1)",
    label: "SCIENCE & PHYTOTECH NODE",
    description: "The scientific archive for South African botanical assets. Standardizing Lab COAs and DNA barcoding to protect regional biodiversity."
  };
}
---

<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width" />
		<title>{identity.title} {identity.suffix} | Official Regulatory Notary</title>
		<script type="application/ld+json" set:html={JSON.stringify(schemaData)} />
	</head>
	<body style="margin: 0; font-family: system-ui, sans-serif; background: #0f172a; color: white; line-height: 1.5;">
		
    <div style={`background: ${identity.color}; color: #000; padding: 0.5rem; text-align: center; font-size: 0.75rem; font-weight: 900; letter-spacing: 0.1rem;`}>
      INSTITUTIONAL LAYER: {identity.
